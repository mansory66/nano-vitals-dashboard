# Nano-Vitals Dashboard

**Производственная платформа мониторинга Core Web Vitals в реальном времени** с использованием React, TypeScript, Node.js и современных DevOps практик. Отслеживайте метрики LCP, FID и CLS с интеллектуальным анализом и рекомендациями по оптимизации.

## Обзор

Nano-Vitals Dashboard — это профессиональное решение для мониторинга производительности веб-сайтов, разработанное для технических команд, которым нужны глубокие инсайты о производительности. Платформа объединяет сбор метрик в реальном времени, интеллектуальный анализ и автоматизированное оповещение для помощи в оптимизации Core Web Vitals.

### Ключевые возможности

- **Мониторинг в реальном времени**: WebSocket-powered live обновления метрик LCP, FID и CLS
- **Отслеживание нескольких сайтов**: Мониторьте несколько веб-сайтов с одной панели управления
- **AI-анализ производительности**: LLM-генерируемые инсайты и рекомендации по оптимизации
- **Умные алерты**: Настраиваемые пороги с мгновенными уведомлениями
- **Интерактивные визуализации**: Анализ трендов производительности на основе Recharts
- **Email отчеты**: Еженедельные/ежемесячные сводки производительности с анализом трендов
- **Production-ready**: Docker, Kubernetes и CI/CD готовность
- **Темная тема UI**: Оптимизирована для технической аудитории с профессиональным дизайном

## Архитектура

### Стек технологий

| Слой | Технология | Назначение |
|------|-----------|-----------|
| **Frontend** | React 19, TypeScript, Tailwind CSS 4 | Современный UI с live обновлениями |
| **Backend** | Express.js, Node.js, tRPC | Type-safe API слой |
| **База данных** | MySQL/TiDB, Drizzle ORM | Масштабируемое хранилище данных |
| **Real-time** | WebSockets | Потоковая передача метрик |
| **AI/ML** | LLM Integration | Анализ производительности и рекомендации |
| **Инфраструктура** | Docker, Kubernetes | Оркестрация контейнеров |
| **Аутентификация** | Manus OAuth | Безопасное управление пользователями |

### Архитектура системы

```
┌─────────────────────────────────────────────────────────────┐
│                    Слой Frontend                             │
│  React + TypeScript + Tailwind CSS + Recharts              │
│  - Дашборд с метриками в реальном времени                  │
│  - Конфигурация алертов и мониторинг                       │
│  - Просмотр анализа производительности                     │
└────────────────────────────┬────────────────────────────────┘
                             │
                    WebSocket & tRPC
                             │
┌────────────────────────────▼────────────────────────────────┐
│                    API слой (tRPC)                           │
│  - websites router (операции CRUD)                          │
│  - metrics router (запись и анализ)                         │
│  - notifications router (подписки на email)                 │
└────────────────────────────┬────────────────────────────────┘
                             │
┌────────────────────────────▼────────────────────────────────┐
│                  Слой бизнес-логики                         │
│  - Расчет Core Web Vitals                                   │
│  - Оценка порогов алертов                                   │
│  - Движок анализа на основе LLM                             │
│  - Планировщик email уведомлений                            │
└────────────────────────────┬────────────────────────────────┘
                             │
┌────────────────────────────▼────────────────────────────────┐
│                  Слой данных (Drizzle ORM)                  │
│  - Таблица websites (отслеживаемые URL)                     │
│  - Таблица coreWebVitals (записи метрик)                    │
│  - Таблица performanceAlerts (конфиги порогов)              │
│  - Таблица alertEvents (история срабатываний)               │
│  - Таблица emailSubscriptions (предпочтения уведомлений)    │
│  - Таблица performanceReports (кэш LLM анализа)             │
└────────────────────────────┬────────────────────────────────┘
                             │
                        MySQL/TiDB
```

## Схема базы данных

Приложение использует нормализованную схему, оптимизированную для временных рядов метрик:

- **users**: Основная аутентификация (интеграция Manus OAuth)
- **websites**: Отслеживаемые URL с метаданными
- **coreWebVitals**: Временные ряды метрик (LCP, FID, CLS, баллы Lighthouse)
- **performanceAlerts**: Настраиваемые пороги для каждого сайта
- **alertEvents**: История срабатываний алертов с уровнями серьезности
- **emailSubscriptions**: Предпочтения уведомлений пользователей
- **performanceReports**: Кэшированные результаты анализа LLM

## Установка и настройка

### Требования

- Node.js 22+
- pnpm 10+
- MySQL 8.0+ или TiDB
- Docker & Docker Compose (для контейнеризованного развертывания)

### Локальная разработка

1. **Клонирование и установка зависимостей**:
   ```bash
   git clone https://github.com/mansory66/nano-vitals-dashboard.git
   cd nano-vitals-dashboard
   pnpm install
   ```

2. **Настройка переменных окружения** (создайте `.env.local`):
   ```bash
   DATABASE_URL=mysql://user:password@localhost:3306/nano_vitals
   JWT_SECRET=your-secret-key
   VITE_APP_ID=your-app-id
   OAUTH_SERVER_URL=https://api.manus.im
   VITE_OAUTH_PORTAL_URL=https://oauth.manus.im
   ```

3. **Инициализация базы данных**:
   ```bash
   pnpm db:push
   ```

4. **Запуск сервера разработки**:
   ```bash
   pnpm dev
   ```

   Приложение будет доступно по адресу `http://localhost:3000`

### Docker развертывание

**Использование Docker Compose** (рекомендуется для локального тестирования):

```bash
docker-compose up --build
```

Это запустит MySQL и приложение. Доступ по адресу `http://localhost:3000`

**Построение Docker образа**:

```bash
docker build -t nano-vitals-dashboard:latest .
docker run -p 3000:3000 \
  -e DATABASE_URL="mysql://user:password@db:3306/nano_vitals" \
  -e JWT_SECRET="your-secret" \
  nano-vitals-dashboard:latest
```

### Развертывание в Kubernetes

1. **Создание секретов и конфигов**:
   ```bash
   kubectl apply -f k8s/config.yaml
   ```

2. **Развертывание приложения**:
   ```bash
   kubectl apply -f k8s/deployment.yaml
   ```

3. **Проверка развертывания**:
   ```bash
   kubectl get pods -l app=nano-vitals-dashboard
   kubectl logs -f deployment/nano-vitals-dashboard
   ```

4. **Доступ к приложению**:
   ```bash
   kubectl port-forward svc/nano-vitals-dashboard 3000:80
   ```

## Документация API

### tRPC процедуры

#### Websites Router

- `websites.list`: Получить все отслеживаемые сайты пользователя
- `websites.create`: Добавить новый сайт для мониторинга
- `websites.getMetrics`: Получить метрики для конкретного сайта
- `websites.getAlerts`: Получить конфигурации алертов
- `websites.getAlertEvents`: Получить недавние срабатывания алертов
- `websites.createAlert`: Создать новый алерт производительности

#### Metrics Router

- `metrics.record`: Записать новое измерение Core Web Vitals
- `metrics.getHistory`: Получить исторические метрики с пагинацией
- `metrics.generateAnalysis`: Запустить LLM анализ метрик
- `metrics.getLatestAnalysis`: Получить кэшированные результаты анализа

#### Notifications Router

- `notifications.subscribe`: Создать подписку на email
- `notifications.getSubscriptions`: Список подписок пользователя

## Оптимизация производительности

### Целевые значения Core Web Vitals

Дашборд использует стандартные пороги индустрии:

| Метрика | Хорошо | Нужно улучшение | Плохо |
|---------|--------|-----------------|-------|
| **LCP** | ≤ 2.5s | 2.5s - 4s | > 4s |
| **FID** | ≤ 100ms | 100ms - 300ms | > 300ms |
| **CLS** | ≤ 0.1 | 0.1 - 0.25 | > 0.25 |

### Оптимизация Frontend

- **Code Splitting**: Ленивая загрузка на основе маршрутов с React.lazy
- **Tree Shaking**: Удаление неиспользуемого кода через Vite
- **Оптимизация изображений**: Эффективная доставка ассетов
- **Оптимизация CSS**: Purging Tailwind и минификация

### Оптимизация Backend

- **Оптимизация запросов**: Индексированные запросы к базе данных для метрик
- **Кэширование**: Результаты анализа LLM кэшируются в базе данных
- **Connection Pooling**: Эффективное управление соединениями с БД
- **Сжатие**: gzip сжатие для API ответов

## Тестирование

### Unit тесты

Запуск тестов с Vitest:

```bash
pnpm test
```

### Покрытие тестами

- Тесты tRPC процедур (аутентификация, мутации, запросы)
- Тесты запросов к базе данных
- Тесты оценки порогов алертов
- Тесты интеграции с LLM

## DevOps и развертывание

### CI/CD Pipeline

Проект готов к GitHub Actions, GitLab CI или аналогичным:

1. **Build**: `pnpm build`
2. **Test**: `pnpm test`
3. **Lint**: `pnpm format`
4. **Docker**: Построение и отправка образа
5. **Deploy**: Kubernetes rollout

### Мониторинг и наблюдаемость

- **Health Checks**: HTTP endpoint по адресу `/health`
- **Логирование**: Структурированные логи для отладки
- **Метрики**: Prometheus-совместимые endpoints (расширяемо)
- **Алерты**: Встроенные алерты Kubernetes

### Масштабирование

Развертывание в Kubernetes включает:

- **Horizontal Pod Autoscaling**: 3-10 реплик на основе CPU/памяти
- **Resource Limits**: 512Mi памяти, 500m CPU на pod
- **Load Balancing**: Распределение трафика на основе Service
- **База данных**: Connection pooling для масштабируемости

## Интеграция с LLM

Дашборд использует LLM для интеллектуального анализа производительности:

```typescript
// Пример: Генерация рекомендаций по оптимизации
const analysis = await trpc.metrics.generateAnalysis.mutate({
  websiteId: 1,
  metrics: recentMetrics,
});
```

LLM анализирует:
- Средние значения LCP, FID, CLS
- Тренды баллов производительности Lighthouse
- Best practices индустрии
- Конкретные рекомендации по оптимизации

## Безопасность

- **Аутентификация**: Manus OAuth для безопасного управления пользователями
- **Авторизация**: Защищенные процедуры с контекстом пользователя
- **Защита данных**: Зашифрованные соединения с базой данных
- **Валидация входных данных**: Валидация схемы Zod на всех входах
- **CORS**: Правильно настроенные политики cross-origin
- **Управление секретами**: Переменные окружения для чувствительных данных

## Решение проблем

### Проблемы с подключением к базе данных

```bash
# Тест подключения к MySQL
mysql -h localhost -u user -p nano_vitals

# Проверка формата DATABASE_URL
echo $DATABASE_URL
```

### Сбои подключения WebSocket

- Убедитесь, что брандмауэр разрешает трафик WebSocket
- Проверьте поддержку WebSocket прокси/балансировщиком нагрузки
- Проверьте конфигурацию CORS для источника WebSocket

### LLM анализ не работает

- Проверьте учетные данные LLM API в окружении
- Проверьте rate limiting и квоту
- Просмотрите логи для ошибок API

## Внесение вклада

1. Форкните репозиторий
2. Создайте ветку функции (`git checkout -b feature/amazing-feature`)
3. Зафиксируйте изменения (`git commit -m 'Add amazing feature'`)
4. Отправьте на ветку (`git push origin feature/amazing-feature`)
5. Откройте Pull Request

## Метрики производительности

Этот проект демонстрирует:

- **Lighthouse Score**: 90+ (оптимизированный frontend)
- **Core Web Vitals**: Все зеленые (LCP < 2.5s, FID < 100ms, CLS < 0.1)
- **First Contentful Paint**: < 1.5s
- **Time to Interactive**: < 3s
- **Размер бандла**: < 200KB (gzipped)

## Лицензия

MIT License - Смотрите файл LICENSE для деталей

## Поддержка и документация

- **Issues**: GitHub Issues для отчетов об ошибках
- **Discussions**: GitHub Discussions для запросов функций
- **Docs**: Встроенная документация кода и JSDoc комментарии

---

**Разработано с экспертизой в** React, TypeScript, Node.js, DevOps и оптимизации производительности. Разработано для технических команд, которые требуют production-grade решений.

**[English version →](./README.md)**
